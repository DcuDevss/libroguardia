{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- esta es la que tiene conflictos -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- <script src="https://cdn.tailwindcss.com"></script> -->
<!-- cdn iconos -->
<script src="https://kit.fontawesome.com/b929cb1411.js" crossorigin="anonymous"></script>
<!-- fuente roboto -->
<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet" />
<!--swit alert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% load static %}


<div style="min-height: 100vh; display: flex; flex-direction: column;">
    <header class="menu-header flex justify-between items-center bg-black text-white p-2">
        <div class="flex items-center" 
                style="
                display: flex;
                font-family: 'Roboto Slab', serif;
                align-items: center;
                justify-content: space-between;"
        >
            <!-- ESCUDO Y TITULO -->
            <div style="display: flex; align-items: center;">
                <img class="mr-4" src="{% static 'comisarias/images/fabico.ico' %}" alt=""
                    style="max-height: 60px; margin-right: 16px" />
                <h1 class="text-3xl" style="font-size: 30px; margin-bottom: 0">
                    Libro Policial
                </h1>
            </div>
            <!-- BOTON ATRAS -->
            <div style="margin-right: 22px;">
                <a href="/"
                style="
                    text-decoration: none;
                    color: white;
                    font-size: 17px;
                    border: solid 1px white;
                    padding: 4px 12px;
                    border-radius: 5px;" 
                    onmouseover="this.style.backgroundColor='white'; this.style.color='black';" 
                    onmouseout="this.style.backgroundColor=''; this.style.color='white';">
                    <i class="fa-solid fa-arrow-left-long"></i>
                    ATRAS
                </a>
            </div>
        </div>
    </header>
    
    <!-- Perfil container -->
    <div style="flex-grow: 1;">
        <div class="profile-container mx-auto mt-5 p-4 shadow-lg rounded bg-white" style="max-width: 700px;">
            <div class="text-center mb-4">
                <div class="profile-picture mb-3">
                    {% if user.personal_profile.photo %}
                    <img src="{{ user.personal_profile.photo.url }}" alt="Foto de Perfil" class="rounded-circle" style="
                  width: 150px;
                  height: 150px;
                  object-fit: cover;
                  border: 2px solid #007bff;
                " />
                    {% else %}
                    <img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" alt="Foto de Perfil" class="rounded-circle" style="
                  width: 150px;
                  height: 150px;
                  object-fit: cover;
                  border: 2px solid #007bff;
                " />
                    {% endif %}
                </div>
                <h1 class="mb-1">
                    Bienvenido, <span class="fw-bold">{{ user.username }}</span>
                </h1>
                <p class="text-muted">Miembro desde {{ user.date_joined|date:"d-m-Y" }}</p>
            </div>
        
            <div class="profile-details">
                <h4 class="text-primary">Información Personal</h4>
                <p>
                    <strong>Nombre completo:</strong> {{ user.get_full_name|default:"No
                    especificado" }}
                </p>
                <p>
                    <strong>DNI:</strong> {{ user.personal_profile.dni|default:"No
                    especificado" }}
                </p>
                <p>
                    <strong>Legajo:</strong> {{ user.personal_profile.legajo|default:"No
                    especificado" }}
                </p>
                <p>
                    <strong>Teléfono:</strong> {{ user.personal_profile.telefono|default:"No
                    especificado" }}
                </p>
                <p>
                    <strong>Domicilio:</strong> {{ user.personal_profile.domicilio|default:"No
                    especificado" }}
                </p>
                <p><strong>Correo electrónico:</strong> {{ user.email }}</p>
            </div>
        
            <div class="actions mt-4 d-flex justify-content-between">
                <button type="button" class="btn btn-primary w-50 me-2" data-bs-toggle="modal"
                    data-bs-target="#editProfileModal">
                    Modificar Perfil
                </button>
                <button type="button" class="btn btn-warning w-50 ms-2" data-bs-toggle="modal"
                    data-bs-target="#passwordChangeModal">
                    Cambiar Contraseña
                </button>
            </div>
        </div>
    </div>
    
    <footer style="background-color: black; color: white; text-align: center; padding: 0.5rem;  margin-left: auto; margin-right: auto; width: 100%;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-left: auto; margin-right: auto;">
            <img src="{% static 'comisarias/images/fabico.ico' %}" alt="" style="max-height: 40px;" />
            <p style="margin: 0;">
                Policia de la Provincia de Tierra del Fuego, Antártida e Islas del Atlántico Sur.
            </p>
        </div>
    </footer>
    
    <!-- Modal para editar perfil -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">Modificar Perfil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProfileForm" method="post" action="{% url 'actualizar_perfil' %}"
                        enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="photo" class="form-label">Foto de Perfil</label>
                            <input type="file" name="photo" id="photo" class="form-control" />
                        </div>
                        <div class="mb-3">
                            <label for="dni" class="form-label">D.N.I</label>
                            <input type="text" name="dni" id="dni" class="form-control"
                                value="{{ user.personal_profile.dni }}" />
                        </div>
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="text" name="telefono" id="telefono" class="form-control"
                                value="{{ user.personal_profile.telefono }}" />
                        </div>
                        <div class="mb-3">
                            <label for="legajo" class="form-label">Legajo</label>
                            <input type="text" name="legajo" id="legajo" class="form-control"
                                value="{{ user.personal_profile.legajo }}" />
                        </div>
                        <div class="mb-3">
                            <label for="domicilio" class="form-label">Domicilio</label>
                            <input type="text" name="domicilio" id="domicilio" class="form-control"
                                value="{{ user.personal_profile.domicilio }}" />
                        </div>
                        <button type="button" id="confirmProfileUpdate" class="btn btn-primary w-100">
                            Guardar Cambios
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para cambiar contraseña -->
    <div class="modal fade" id="passwordChangeModal" tabindex="-1" aria-labelledby="passwordChangeModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="passwordChangeModalLabel">
                        Cambiar Contraseña
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="passwordChangeForm" method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="id_old_password" class="form-label">Contraseña Actual</label>
                            <input type="password" name="old_password" id="id_old_password" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label for="id_new_password1" class="form-label">Nueva Contraseña</label>
                            <input type="password" name="new_password1" id="id_new_password1" class="form-control"
                                required />
                        </div>
                        <div class="mb-3">
                            <label for="id_new_password2" class="form-label">Confirmar Nueva Contraseña</label>
                            <input type="password" name="new_password2" id="id_new_password2" class="form-control"
                                required />
                        </div>
                        <button type="submit" class="btn btn-warning w-100">
                            Actualizar Contraseña
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll(".toggle-password").forEach((button) => {
        button.addEventListener("click", () => {
            const targetInput = document.querySelector(button.dataset.target);
            const icon = button.querySelector("i");
            if (targetInput.type === "password") {
                targetInput.type = "text";
                icon.classList.replace("bi-eye", "bi-eye-slash");
            } else {
                targetInput.type = "password";
                icon.classList.replace("bi-eye-slash", "bi-eye");
            }
        });
    });
</script>
<script>
    document.getElementById('confirmProfileUpdate').addEventListener('click', function (event) {
        Swal.fire({
            title: '¿Estás seguro?',
            text: "Solo podrás modificar estos datos una vez.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, actualizar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('editProfileForm').submit();
            }
        });
    });
    document.addEventListener('DOMContentLoaded', function () {
        {% for message in messages %}
        Swal.fire({
            title: 'Mensaje',
            text: "{{ message }}",
            icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% elif message.tags == 'warning' %}warning{% elif message.tags == 'info' %}info{% else %}question{% endif %}",
            confirmButtonText: 'Aceptar'
        });
        {% endfor %}
    });
</script>

{% endblock %}